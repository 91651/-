@page "/admin/article"
@attribute [Authorize]
@using System.ComponentModel
@using AntDesign.TableModels
@using App.Business.Model
@using App.EFCore.DynamicLinq
@using Microsoft.AspNetCore.Authorization
@inject HttpClient Http

<PageTitle>Index</PageTitle>

<Card Hoverable>
    <Card>
         <Space>
            <SpaceItem>
                <Input Placeholder="序号" @bind-Value="@query.Id" />
            </SpaceItem>
            <SpaceItem>
                <Input Placeholder="关键字" @bind-Value="@query.Keyword" />
            </SpaceItem>
            <SpaceItem>
                <Space>
                           <SpaceItem>
                               <Button Type="@ButtonType.Primary" @onclick="Query">查询</Button>
                           </SpaceItem>
                           <SpaceItem>
                               <Button Danger>新建</Button>
                           </SpaceItem>
                        </Space>
            </SpaceItem>
        </Space>
    </Card>
    <br />
    <Table TItem="ArticleListModel" Bordered=@true DataSource="@data.Data" OnRowClick="OnRowClick">
        <Column @bind-Field="@context.Id">
            <a>@context.Id</a>
        </Column>
        <Column @bind-Field="@context.Title"></Column>
        <Column @bind-Field="@context.ChannelName">
        </Column>
        <Column @bind-Field="@context.UserName">
        </Column>
        <Column @bind-Field="@context.Created">
        </Column>
        <Column @bind-Field="@context.Updated">
        </Column>
        <ActionColumn Title="操作">
            <Space Size=@("middle")>
                <SpaceItem>
                    <a>编辑</a>
                </SpaceItem>
                <SpaceItem>
                    <a>删除</a>
                </SpaceItem>
            </Space>
        </ActionColumn>
    </Table>
</Card>

@code {
    private ArticleQueryModel query = new ();
    private PageResult<List<ArticleListModel>> data = new();

    protected override async Task OnInitializedAsync()
    {
        await GetArticles();
    }

    private async Task GetArticles()
    {
        var resp = await Http.PostAsJsonAsync<ArticleQueryModel>("/api/admin/article/query", query);
        data = await resp.Content.ReadFromJsonAsync<PageResult<List<ArticleListModel>>>();
    }

    private async Task Query()
    {
        GetArticles();
    }
    //Data[] data = new Data[]
    //{
    //    new()
    //    {
    //        Key = "1",
    //        Name = "John Brown",
    //        Age = 32,
    //        Address = "New York No. 1 Lake Park",
    //        Tags = new[] {"nice", "developer"}
    //    },
    //    new()
    //    {
    //        Key = "2",
    //        Name = "Jim Green",
    //        Age = 42,
    //        Address = "London No. 1 Lake Park",
    //        Tags = new[] { "loser"}
    //    },
    //    new()
    //    {
    //        Key = "3",
    //        Name = "Joe Black",
    //        Age = 32,
    //        Address = "Sidney No. 1 Lake Park",
    //        Tags = new[] { "cool", "teacher" }
    //    }
    //};

    //public class Data
    //{
    //    [DisplayName("Key")]
    //    public string Key { get; set; }

    //    [DisplayName("Name")]
    //    public string Name { get; set; }

    //    [DisplayName("Age")]
    //    public int Age { get; set; }

    //    [DisplayName("Address")]
    //    public string Address { get; set; }

    //    [DisplayName("Tags")]
    //    public string[] Tags { get; set; }
    //}

    void OnRowClick(RowData<ArticleListModel> row)
    {
        Console.WriteLine($"row {row.Data.Id} was clicked.");
    }
}